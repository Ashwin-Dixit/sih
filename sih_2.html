<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sankat Saathi</title>
    <!-- Tailwind CSS for modern, responsive design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .card {
            background-color: white;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease-in-out;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .cta-button {
            background-image: linear-gradient(to right, #4CAF50 0%, #6A994E 100%);
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 9999px;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            transform: scale(1);
        }
        .cta-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        .module-card {
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            position: relative;
            overflow: hidden;
        }
        .module-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 25px rgba(0, 0, 0, 0.1);
        }
        .vr-simulation-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        .vr-simulation-container.active {
            display: flex;
            opacity: 1;
        }
        .vr-simulation-content {
            width: 80%;
            height: 70%;
            background: url('https://placehold.co/800x600/1e293b/d1d5db?text=Simulated+360+View') no-repeat center center / cover;
            border-radius: 1rem;
            position: relative;
            overflow: hidden;
            cursor: grab;
            transition: all 0.5s ease;
        }

        /* Chatbot Styles */
        .chatbot-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 999;
            font-family: 'Inter', sans-serif;
        }
        
        .chatbot-toggle {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #4CAF50 0%, #6A994E 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }
        
        .chatbot-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 30px rgba(76, 175, 80, 0.4);
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(76, 175, 80, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
        }
        
        .chatbot-window {
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            display: none;
            flex-direction: column;
            overflow: hidden;
            position: absolute;
            bottom: 80px;
            right: 0;
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .chatbot-window.active {
            display: flex;
            transform: translateY(0);
            opacity: 1;
        }
        
        .chatbot-header {
            background: linear-gradient(135deg, #4CAF50 0%, #6A994E 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .chatbot-close {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.2s;
        }
        
        .chatbot-close:hover {
            opacity: 1;
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8fafc;
        }
        
        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            animation: fadeInUp 0.3s ease;
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message-bot {
            flex-direction: row;
        }
        
        .message-user {
            flex-direction: row-reverse;
        }
        
        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .bot-avatar {
            background: linear-gradient(135deg, #4CAF50 0%, #6A994E 100%);
            color: white;
        }
        
        .user-avatar {
            background: #e2e8f0;
            color: #64748b;
        }
        
        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.4;
            font-size: 14px;
        }
        
        .bot-message {
            background: white;
            color: #334155;
            border-bottom-left-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        
        .user-message {
            background: linear-gradient(135deg, #4CAF50 0%, #6A994E 100%);
            color: white;
            border-bottom-right-radius: 6px;
        }
        
        .chat-input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e2e8f0;
        }
        
        .chat-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            outline: none;
            font-size: 14px;
            transition: border-color 0.2s;
        }
        
        .chat-input:focus {
            border-color: #4CAF50;
        }
        
        .chat-send {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #4CAF50 0%, #6A994E 100%);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }
        
        .chat-send:hover {
            transform: scale(1.05);
        }
        
        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .quick-action {
            background: white;
            border: 1px solid #e2e8f0;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            color: #64748b;
        }
        
        .quick-action:hover {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }
        
        .typing-indicator {
            display: none;
            align-items: center;
            gap: 5px;
            color: #64748b;
            font-style: italic;
            font-size: 12px;
        }
        
        .typing-dots {
            display: flex;
            gap: 2px;
        }
        
        .typing-dot {
            width: 4px;
            height: 4px;
            background: #64748b;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        @media (max-width: 768px) {
            .chatbot-window {
                width: 90vw;
                height: 70vh;
                right: 50%;
                transform: translateX(50%) translateY(20px);
            }
            
            .chatbot-window.active {
                transform: translateX(50%) translateY(0);
            }
        }
    </style>
</head>

<body class="bg-[#f0f4f8] text-gray-900 antialiased p-4 sm:p-8 flex items-center justify-center min-h-screen">

    <main id="main-content" class="w-full max-w-7xl mx-auto space-y-8 p-4 md:p-8 rounded-3xl">

        <!-- Header and User Info -->
        <header class="flex flex-col md:flex-row items-center justify-between space-y-4 md:space-y-0"><!--md:space-y-0 p-6 card-->
            <div class="text-center md:text-left">
                <h1 class="text-4xl md:text-5xl font-extrabold text-gray-800">Sankat Saathi</h1>
                <p class="text-md text-gray-500 mt-1">Disaster Preparedness for Schools and Colleges</p>
            </div>
            <div class="flex items-center space-x-4">
                <div class="text-right">
                    <p class="font-bold text-lg text-gray-700" id="user-name">Hello, User!</p>
                    <p class="text-sm text-gray-500">Your Credits: <span id="user-credits" class="font-semibold text-green-600">0</span></p>
                </div>
                <div class="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center text-xl font-bold text-gray-600">U</div>
            </div>
        </header>

        <!-- Main Content Area with Modules -->
        <div id="main-dashboard-sections" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

            <!-- Disaster Preparedness Module -->
            <div id="module-earthquake" class="module-card card p-6 cursor-pointer">
                <div class="flex items-center justify-center mb-4">
                    <i class="fas fa-house-damage text-5xl text-gray-600"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800 text-center mb-2">Disaster Preparedness</h2>
                <p class="text-gray-500 text-center text-sm">Learn life-saving protocols. Complete the quiz and upload your mock drill video to earn credits.</p>
                <div class="mt-4 text-center">
                    <button id="start-module-btn" class="cta-button text-sm">Start Module</button>
                </div>
            </div>
            <!--my edit for game module-->
            <div id="module-game" class="module-card card p-6 cursor-pointer">
                <div class="flex items-center justify-center mb-4">
                    <i class="fa-solid fa-gamepad text-5xl text-gray-600"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800 text-center mb-2">Game section</h2>
                <p class="text-gray-500 text-center text-sm">Play interactive 'Real life Situation' based game.</p><br>
                <p class="text-gray-500 text-center text-sm">This section contains 'Real World situation' based games with storyline to keep you hooked(we swear Disney ending <i class="fa-regular fa-face-smile-beam"></i>)</p>
                <div class="mt-4 text-center">
                    <button id="start-game-btn" class="cta-button text-sm">Get Started</button>
                </div>
            </div>
            <!--end-->

            <!-- Helping Hand Section -->
            <div id="helping-hand-section" class="card p-6 col-span-1 md:col-span-2 lg:col-span-1">
                <div class="flex items-center justify-center mb-4">
                    <i class="fa-solid fa-people-pulling text-5xl text-gray-600"></i>
                </div>
                
                <h2 class="text-2xl font-bold text-gray-800 text-center mb-4">Helping Hand Community</h2>
                <p class="text-gray-500 text-center mb-4 text-sm">Share how you would react in a crisis. Upload a video and get inspired!</p>
                <div id="helping-hand-videos" class="space-y-4 max-h-60 overflow-y-auto">
                    <!-- Placeholder video cards -->
                    <div class="bg-gray-50 p-4 rounded-lg flex items-center space-x-4">
                        <div class="w-12 h-12 bg-gray-200 rounded-md flex-shrink-0 flex items-center justify-center text-xl text-gray-500"><i class="fas fa-video"></i></div>
                        <div class="flex-grow">
                            <p class="font-semibold text-gray-800">First Aid</p>
                            <p class="text-sm text-gray-500">Rituraj & Ashwin</p>
                        </div>
                        <div class="flex items-center space-x-3 text-gray-500">
                            <button class="like-btn" data-likes="12"><i class="fas fa-heart text-red-500"></i> <span class="likes-count">12</span></button>
                            <button class="follow-btn text-blue-500 text-sm font-semibold">Follow</button>
                        </div>
                    </div>
                </div>
                <div class="mt-4 text-center">
                    <button id="upload-video-btn" class="cta-button text-sm">Upload Video</button>
                </div>
            </div>
            <!--my edit for leader board-->
            <div id="leaderboard-section" class="card p-6 col-span-1 md:col-span-2 lg:col-span-1">
                <h2 class="text-2xl font-bold text-gray-800 text-center mb-4">Leaderboard <i class="fa-solid fa-ranking-star"></i></h2>
                <p class="text-gray-500 text-center mb-4 text-sm">Play games, Get higher!</p>
                <p class="text-gray-500 text-center mb-4 text-sm">Current League : Emerald</p>
                <div id="leaderboard-users" class="space-y-4 max-h-60 overflow-y-auto">
                    <!-- Placeholder rankings card -->
                    <div class="bg-gray-50 p-4 rounded-lg flex items-center space-x-4">
                        <div class="w-12 h-12 bg-gray-200 rounded-md flex-shrink-0 flex items-center justify-center text-xl text-gray-500"><i class="fa-solid fa-medal"></i></div>
                        <div class="flex-grow">
                            <p class="font-semibold text-gray-800">user 1</p>
                            <p class="text-sm text-gray-500">user-id</p>
                        </div>
                        <div class="flex items-center space-x-3 text-gray-500">
                             <span >League Credits 12</span>
                            
                        </div>
                    </div>
                </div>
                
            </div>
            <!--end-->


            <!-- Admin Dashboard Mock -->
            <div id="admin-dashboard" class="card p-6 col-span-1 md:col-span-2 lg:col-span-1">
                <h2 class="text-2xl font-bold text-gray-800 text-center mb-4">Admin Dashboard</h2>
                <p class="text-gray-500 text-center mb-4 text-sm">A quick look at your institution's preparedness metrics.</p>
                <div class="grid grid-cols-2 gap-4 text-center">
                    <div class="p-4 bg-blue-100 rounded-lg">
                        <p class="text-4xl font-bold text-blue-600" id="total-users">254</p>
                        <p class="text-sm text-blue-800 mt-1">Total Users</p>
                    </div>
                    <div class="p-4 bg-green-100 rounded-lg">
                        <p class="text-4xl font-bold text-green-600" id="completion-rate">78%</p>
                        <p class="text-sm text-green-800 mt-1">Average Module Completion</p>
                    </div>
                </div>
                <div class="mt-4 p-4 bg-yellow-100 rounded-lg text-center">
                    <p class="text-2xl font-bold text-yellow-600" id="pending-drills">14</p>
                    <p class="text-sm text-yellow-800 mt-1">Mock Drill Videos uploded</p>
                </div>
            </div>
        </div>

        <!-- Quiz and Mock Drill Section (Initially hidden) -->
        <section id="quiz-section" class="hidden card p-8 my-8 space-y-6">
            <h2 class="text-3xl font-bold text-gray-800 text-center">Quiz: Earthquake Protocols</h2>
            <div id="quiz-question" class="text-lg text-gray-700 font-semibold">
                <!-- Question will be loaded here -->
            </div>
            <div id="quiz-options" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Options will be loaded here -->
            </div>
            <div class="text-center mt-6">
                <button id="submit-answer-btn" class="cta-button">Submit Answer</button>
            </div>
            <div class="text-center mt-6">
                <button id="back-to-dashboard-btn" class="cta-button text-sm">Back to Dashboard</button>
            </div>
            <div id="quiz-feedback" class="text-center mt-4"></div>
        </section>
         <!-- my edited game section (Initially hidden) -->
        <section id="game-section" class="hidden card p-8 my-8 space-y-6">
            <h2 class="text-3xl font-bold text-gray-800 text-center">Storyline 1 (Level : 1)</h2>
            <div id="story-section-1" class="text-lg text-gray-700 font-semibold">
                <!-- section 1 will be loaded here -->
                 <h4 class="text-3xl font-bold text-gray-800 text-center">Comming soon.....<i class="fa-solid fa-hourglass-start"></i> </h4>
                 <p>(Qualify NEXUS NODE pleeeeeease.....!!)</p>
            </div>
            <div class="text-center mt-6">
                <button id="back-to-dashboard-btn" class="cta-button text-sm">Back to Dashboard</button>
            </div>
            <!--<div id="quiz-options" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                
            </div>
            <div class="text-center mt-6">
                <button id="submit-answer-btn" class="cta-button">Submit Answer</button>
            </div>
            <div id="quiz-feedback" class="text-center mt-4"></div>-->
        </section>

        <!-- Mock Drill and VR Section (Initially hidden) -->
        <section id="mock-drill-section" class="hidden card p-8 my-8 space-y-6">
            <h2 class="text-3xl font-bold text-gray-800 text-center mb-6">Your Mock Drill</h2>
            <div class="flex flex-col md:flex-row justify-center items-center space-y-4 md:space-y-0 md:space-x-8">
                <div class="w-full md:w-1/2 p-4 bg-gray-50 rounded-xl text-center">
                    <p class="text-xl font-semibold text-gray-800 mb-2">Upload your drill video!</p>
                    <p class="text-gray-500 text-sm mb-4">Show your "Drop, Cover, Hold On" in action to earn 100 credits.</p>
                    <button id="upload-mock-drill-btn" class="cta-button text-sm">Upload Video</button>
                </div>
                <div class="w-full md:w-1/2 p-4 bg-gray-50 rounded-xl text-center">
                    <p class="text-xl font-semibold text-gray-800 mb-2">Simulated VR Experience</p>
                    <p class="text-gray-500 text-sm mb-4">Experience a simulated 360-degree view of an earthquake scenario.</p>
                    <button id="open-vr-btn" class="cta-button text-sm">Enter VR Mode</button>
                </div>
            </div>
            <div class="text-center mt-6">
                <button id="back-to-dashboard-btn" class="cta-button text-sm">Back to Dashboard</button>
            </div>
        </section>
        
        <!-- War Simulation Module (Initially hidden) -->
        <section id="war-module-section" class="hidden card p-8 my-8 space-y-6">
            <h2 class="text-3xl font-bold text-gray-800 text-center">War-like Situation Protocols</h2>
            <div class="text-lg text-gray-700">
                <p class="mb-4">As a border state, it's crucial to understand protocols for war-like situations. This module covers:</p>
                <ul class="list-disc list-inside space-y-2 text-gray-600">
                    <li>**"Lockdown" and "Shelter-in-Place" procedures:** Understanding the difference and when to use each.</li>
                    <li>**Emergency blackout protocols:** How to secure your location during an air raid warning.</li>
                    <li>**Communication and Alert Systems:** Identifying official channels for real-time information.</li>
                </ul>
            </div>
            <div class="text-center mt-6">
                <button id="start-war-module-btn" class="cta-button text-sm">Complete this module and earn credits</button>
            </div>
        </section>
        <footer class="flex flex-col md:flex-row items-center justify-between space-y-4 md:space-y-0"><!--md:space-y-0 p-6 card-->
            <div class="text-center md:text-left">

                <p class="text-md text-gray-500 mt-1">created with <i class="fa-solid fa-heart"></i> by NEXUS NODE.</p>
                <p class="text-md text-gray-500 mt-1">Stay Safe, Stay Alert.</p>
            </div>
            
        </footer>
        
    </main>

    <!-- VR Simulation Container (Hidden) -->
    <div id="vr-simulation" class="vr-simulation-container">
        <div id="vr-content" class="vr-simulation-content"></div>
        <button id="exit-vr-btn" class="mt-8 text-white text-lg font-semibold">&times; Exit VR</button>
    </div>

    <!-- Alert Modal (replaces browser's alert) -->
    <div id="alert-modal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-xl shadow-2xl max-w-sm w-full text-center">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">Action Complete!</h3>
            <p id="alert-message" class="text-gray-600 mb-6">This is a message.</p>
            <button id="alert-ok-btn" class="cta-button w-full">OK</button>
        </div>
    </div>

    <!-- Saathi AI Chatbot -->
    <div class="chatbot-container">
        <div id="chatbot-window" class="chatbot-window">
            <div class="chatbot-header">
                <div class="flex items-center justify-center gap-2">
                    <i class="fas fa-robot text-2xl"></i>
                    <div>
                        <h3 class="font-bold text-lg">Saathi AI</h3>
                        <p class="text-sm opacity-90">Your Disaster Companion</p>
                    </div>
                </div>
                <button id="chatbot-close" class="chatbot-close">×</button>
            </div>
            
            <div id="chat-messages" class="chat-messages">
                <div class="message message-bot">
                    <div class="message-avatar bot-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content bot-message">
                        Hi! I'm Saathi, your disaster preparedness companion. I'm here to help you stay safe and prepared. How can I assist you today?
                        
                        <div class="quick-actions">
                            <span class="quick-action" data-action="emergency">🚨 Emergency Help</span>
                            <span class="quick-action" data-action="weather">🌤️ Weather Alerts</span>
                            <span class="quick-action" data-action="earthquake">🏠 Earthquake Safety</span>
                            <span class="quick-action" data-action="fire">🔥 Fire Safety</span>
                            <span class="quick-action" data-action="news">📰 Disaster News</span>
                            <span class="quick-action" data-action="hospitals">🏥 Find Hospitals</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="typing-indicator">
                <div class="message-avatar bot-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <span>Saathi is typing</span>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
            
            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <input type="text" id="chat-input" class="chat-input" placeholder="Ask Saathi anything about disaster safety..." maxlength="500">
                    <button id="chat-send" class="chat-send">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <div id="chatbot-toggle" class="chatbot-toggle">
            <i class="fas fa-robot"></i>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const state = {
                currentView: 'dashboard',
                credits: 0,
                quizCompleted: false,
                mockDrillUploaded: false,
            };

            const userCreditsElement = document.getElementById('user-credits');
            const mainContent = document.getElementById('main-content');
            const moduleEarthquake = document.getElementById('module-earthquake');
            const quizSection = document.getElementById('quiz-section');
            const mockDrillSection = document.getElementById('mock-drill-section');
            const startModuleBtn = document.getElementById('start-module-btn');
            const backToDashboardBtn = document.querySelectorAll("#back-to-dashboard-btn");
            const uploadMockDrillBtn = document.getElementById('upload-mock-drill-btn');
            const openVrBtn = document.getElementById('open-vr-btn');
            const vrSimulation = document.getElementById('vr-simulation');
            const exitVrBtn = document.getElementById('exit-vr-btn');
            const vrContent = document.getElementById('vr-content');
            const helpingHandSection = document.getElementById('helping-hand-section');
            const uploadVideoBtn = document.getElementById('upload-video-btn');
            const helpingHandVideos = document.getElementById('helping-hand-videos');
            const alertModal = document.getElementById('alert-modal');
            const alertMessage = document.getElementById('alert-message');
            const alertOkBtn = document.getElementById('alert-ok-btn');
            const mainDashboardSections = document.getElementById('main-dashboard-sections');
            //my edited element for leaderboard
            const leaderboardSection = document.getElementById('leaderboard-section');
            const leaderboardUsers = document.getElementById('leaderboard-users');
            //my edited element for game
            const startGameBtn = document.getElementById('start-game-btn');

            // Chatbot Elements
            const chatbotToggle = document.getElementById('chatbot-toggle');
            const chatbotWindow = document.getElementById('chatbot-window');
            const chatbotClose = document.getElementById('chatbot-close');
            const chatMessages = document.getElementById('chat-messages');
            const chatInput = document.getElementById('chat-input');
            const chatSend = document.getElementById('chat-send');
            const typingIndicator = document.querySelector('.typing-indicator');

            // --- UI/View Management ---
            function showView(viewId) {
                const sections = document.querySelectorAll('main section');
                sections.forEach(section => section.classList.add('hidden'));
                
                // Hide the main dashboard sections when switching to a module
                if (viewId !== 'dashboard') {
                    mainDashboardSections.classList.add('hidden');
                } else {
                    mainDashboardSections.classList.remove('hidden');
                }

                document.getElementById(viewId).classList.remove('hidden');
            }

            // --- Custom Alert Function ---
            function showAlert(message) {
                alertMessage.textContent = message;
                alertModal.classList.remove('hidden');
            }

            alertOkBtn.addEventListener('click', () => {
                alertModal.classList.add('hidden');
            });

            // --- Enhanced Chatbot with API Integration ---
            let userLocation = { lat: 28.6139, lon: 77.2090 }; // Default to Delhi
            
            // Get user's location
            function getUserLocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition((position) => {
                        userLocation.lat = position.coords.latitude;
                        userLocation.lon = position.coords.longitude;
                        addMessage("📍 Location detected! I can now provide location-specific alerts and emergency services.", false);
                    }, (error) => {
                        addMessage("📍 Using Delhi as default location. You can share your location for personalized alerts.", false);
                    });
                }
            }

            // Weather API Integration
            async function getWeatherAlerts() {
                try {
                    const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${userLocation.lat}&lon=${userLocation.lon}&appid=YOUR_API_KEY&units=metric`);
                    // For demo purposes, return mock severe weather data
                    return {
                        alerts: [
                            "⚠️ Heavy rainfall expected in your area today",
                            "🌪️ Thunderstorm warning for next 3 hours"
                        ],
                        temperature: "32°C",
                        humidity: "85%",
                        condition: "Thunderstorm"
                    };
                } catch (error) {
                    return {
                        alerts: ["Weather service temporarily unavailable"],
                        temperature: "N/A",
                        condition: "Unknown"
                    };
                }
            }

            // Disaster News API Integration
            async function getDisasterNews() {
                try {
                    // Mock disaster news data (in real implementation, use NewsAPI)
                    return [
                        "🔥 Forest fire reported in Uttarakhand - evacuation orders issued",
                        "🌊 Flood warning for coastal Karnataka and Kerala",
                        "🏠 4.2 magnitude earthquake recorded near Shimla"
                    ];
                } catch (error) {
                    return ["News service temporarily unavailable"];
                }
            }

            // Emergency Services Locator
            async function findNearbyServices(serviceType) {
                // Mock nearby services (in real implementation, use Google Places API)
                const services = {
                    hospital: [
                        "🏥 AIIMS Delhi - 2.3 km away",
                        "🏥 Safdarjung Hospital - 3.1 km away",
                        "🏥 Ram Manohar Lohia Hospital - 4.2 km away"
                    ],
                    police: [
                        "👮 CP Police Station - 1.2 km away",
                        "👮 Parliament Street Police Station - 2.0 km away"
                    ],
                    fire: [
                        "🚒 Fire Station Connaught Place - 1.8 km away",
                        "🚒 Central Fire Station - 3.5 km away"
                    ]
                };
                return services[serviceType] || ["No services found nearby"];
            }

            // AI-powered response generation
            async function getAIResponse(message) {
                // This would integrate with OpenAI API in production
                // For demo, return contextual responses
                const msg = message.toLowerCase();
                
                // Smart contextual responses
                if (msg.includes('current') && msg.includes('weather')) {
                    const weather = await getWeatherAlerts();
                    return `🌤️ **Current Weather Conditions:**\n\nTemperature: ${weather.temperature}\nCondition: ${weather.condition}\nHumidity: ${weather.humidity}\n\n**Active Alerts:**\n${weather.alerts.join('\n')}\n\n💡 Stay updated with weather conditions for better disaster preparedness!`;
                }
                
                if (msg.includes('news') || msg.includes('latest') || msg.includes('recent')) {
                    const news = await getDisasterNews();
                    return `📰 **Latest Disaster Updates:**\n\n${news.join('\n')}\n\n⚠️ Stay informed and follow official emergency guidelines.`;
                }
                
                if (msg.includes('hospital') || msg.includes('medical')) {
                    const hospitals = await findNearbyServices('hospital');
                    return `🏥 **Nearby Hospitals:**\n\n${hospitals.join('\n')}\n\n🚨 For medical emergencies, call 102 immediately!`;
                }
                
                if (msg.includes('police') || msg.includes('security')) {
                    const police = await findNearbyServices('police');
                    return `👮 **Nearby Police Stations:**\n\n${police.join('\n')}\n\n🚨 For emergencies, call 100 immediately!`;
                }
                
                if (msg.includes('fire station') || msg.includes('fire department')) {
                    const fireStations = await findNearbyServices('fire');
                    return `🚒 **Nearby Fire Stations:**\n\n${fireStations.join('\n')}\n\n🚨 For fire emergencies, call 101 immediately!`;
                }
                
                return getStaticResponse(message);
            }

            // Static knowledge base (fallback)
            function getStaticResponse(message) {
                const msg = message.toLowerCase();
                
                const responses = {
                    earthquake: {
                        during: "🏠 **During Earthquake:**\n\n• DROP to hands and knees immediately\n• Take COVER under sturdy furniture\n• HOLD ON and protect your head/neck\n• Stay away from windows and heavy objects\n• If outdoors, move away from buildings\n\n🆘 **Emergency?** Call 112 now!",
                        before: "📋 **Earthquake Preparedness:**\n\n• Create emergency kit with 3 days supplies\n• Identify safe spots in each room\n• Practice Drop-Cover-Hold drills\n• Secure heavy furniture to walls\n• Learn to shut off utilities\n• Make family communication plan",
                        after: "✅ **After Earthquake:**\n\n• Check for injuries and give first aid\n• Look for hazards (gas leaks, structural damage)\n• Expect aftershocks - be ready to Drop-Cover-Hold\n• Use flashlights, not candles\n• Stay away from damaged buildings\n• Listen to emergency broadcasts"
                    },
                    fire: {
                        escape: "🔥 **Fire Escape Protocol:**\n\n• Stay LOW - smoke rises, clean air is near floor\n• Feel doors before opening - if hot, find another way\n• Use stairs NEVER elevators\n• If trapped, seal door cracks, signal for help\n• Stop-Drop-Roll if clothes catch fire\n\n🚨 **Emergency?** Call 101 now!",
                        prevention: "🛡️ **Fire Prevention:**\n\n• Install smoke detectors on every floor\n• Keep fire extinguishers accessible\n• Practice escape routes monthly\n• Check electrical wiring regularly\n• Store flammable materials safely\n• Create family escape plan with meeting point"
                    },
                    flood: {
                        safety: "🌊 **Flood Safety Rules:**\n\n• NEVER walk/drive through flood water\n• 6 inches can knock you down, 12 inches can carry car away\n• Move to higher ground immediately\n• Avoid electrical hazards in flooded areas\n• Listen for evacuation orders\n• Stay away from storm drains\n\n⚠️ **Emergency?** Call 112!"
                    }
                };

                // Intelligent matching
                if (msg.includes('earthquake') || msg.includes('भूकंप')) {
                    if (msg.includes('during') || msg.includes('happening') || msg.includes('now')) return responses.earthquake.during;
                    if (msg.includes('prepare') || msg.includes('before') || msg.includes('ready')) return responses.earthquake.before;
                    if (msg.includes('after') || msg.includes('ended')) return responses.earthquake.after;
                    return responses.earthquake.during; // Default to immediate action
                }
                
                if (msg.includes('fire') || msg.includes('आग') || msg.includes('burning')) {
                    if (msg.includes('escape') || msg.includes('trapped') || msg.includes('emergency')) return responses.fire.escape;
                    return responses.fire.prevention;
                }
                
                if (msg.includes('flood') || msg.includes('बाढ़') || msg.includes('water')) {
                    return responses.flood.safety;
                }
                
                if (msg.includes('emergency') || msg.includes('help') || msg.includes('danger')) {
                    return "🚨 **IMMEDIATE EMERGENCY?**\n\nCall these numbers NOW:\n• 112 - National Emergency\n• 101 - Fire\n• 102 - Ambulance\n• 100 - Police\n\n📍 I can help find nearby emergency services. Try: 'find nearby hospitals' or 'locate police stations'";
                }
                
                if (msg.includes('kit') || msg.includes('supplies') || msg.includes('prepare')) {
                    return "🎒 **Emergency Kit Essentials:**\n\n**Water & Food (3 days minimum):**\n• 4 liters water per person per day\n• Non-perishable food\n• Can opener, utensils\n\n**Safety & Communication:**\n• Flashlight + extra batteries\n• Battery/hand-crank radio\n• First aid kit\n• Whistle for signaling\n• Cell phone charger\n\n**Personal Items:**\n• Medications\n• Cash in small bills\n• Important documents (copies)\n• Extra clothing\n• Personal hygiene items";
                }
                
                if (msg.includes('drill') || msg.includes('practice') || msg.includes('training')) {
                    return "📋 **Mock Drill Best Practices:**\n\n⏱️ **Monthly Practice:**\n• Earthquake: Drop-Cover-Hold (under 1 minute)\n• Fire: Evacuation routes (under 2 minutes)\n• Different scenarios (day/night, different locations)\n\n👥 **Family/Group Roles:**\n• Assign responsibilities\n• Identify meeting points\n• Practice with pets/elderly\n\n📱 **Documentation:**\n• Time your drills\n• Note improvement areas\n• Update contact information\n\nWant specific drill instructions for earthquakes, fires, or floods?";
                }
                
                if (msg.includes('hello') || msg.includes('hi') || msg.includes('hey') || msg.includes('start')) {
                    return "👋 **Hello! I'm Saathi - Your Smart Disaster Companion**\n\n🔴 **Live Services:**\n• 🌤️ Current weather alerts\n• 📰 Latest disaster news\n• 📍 Nearby emergency services\n• 🤖 AI-powered safety guidance\n\n💬 **Try asking:**\n• 'Current weather conditions'\n• 'Find nearby hospitals'\n• 'What to do during earthquake?'\n• 'Latest disaster news'\n\n🆘 **Emergency? Call 112 immediately!**";
                }
                
                if (msg.includes('thank') || msg.includes('thanks')) {
                    return "🙏 **You're welcome!**\n\nRemember: Being prepared saves lives. Stay safe, stay alert, and practice these safety measures regularly!\n\n💡 I'm always here for emergency guidance, weather updates, and safety tips. What else can I help you with?";
                }
                
                // AI-like general response
                return `🤖 **I understand you're asking about: "${message}"**\n\nI can help with:\n\n🏠 **Disaster Safety:** Earthquake, fire, flood protocols\n🌤️ **Live Updates:** Weather alerts, disaster news\n📍 **Location Services:** Nearby hospitals, police, fire stations\n🎒 **Preparedness:** Emergency kits, drill guidance\n\n💬 **Try being more specific:** 'earthquake safety', 'current weather', 'find hospitals nearby'\n\n🆘 **Emergency? Call 112 now!**`;
            }

            async function getBotResponse(message) {
                return await getAIResponse(message);
            }

            function addMessage(content, isUser = false) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isUser ? 'message-user' : 'message-bot'}`;
                
                messageDiv.innerHTML = `
                    <div class="message-avatar ${isUser ? 'user-avatar' : 'bot-avatar'}">
                        ${isUser ? 'U' : '<i class="fas fa-robot"></i>'}
                    </div>
                    <div class="message-content ${isUser ? 'user-message' : 'bot-message'}">
                        ${content.replace(/\n/g, '<br>')}
                    </div>
                `;
                
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            function showTyping() {
                typingIndicator.style.display = 'flex';
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            function hideTyping() {
                typingIndicator.style.display = 'none';
            }

            function sendMessage() {
                const message = chatInput.value.trim();
                if (!message) return;
                
                // Add user message
                addMessage(message, true);
                chatInput.value = '';
                
                // Show typing indicator
                showTyping();
                
                // Get AI-powered response
                getBotResponse(message).then(response => {
                    setTimeout(() => {
                        hideTyping();
                        addMessage(response);
                    }, 1500 + Math.random() * 1000); // 1.5-2.5 second delay for realism
                }).catch(error => {
                    setTimeout(() => {
                        hideTyping();
                        addMessage("I apologize, I'm having trouble connecting to some services. Let me help you with basic disaster safety information. What would you like to know?");
                    }, 1000);
                });
            }

            // Chatbot Event Listeners
            chatbotToggle.addEventListener('click', () => {
                chatbotWindow.classList.add('active');
                chatInput.focus();
                // Get location when chatbot opens for first time
                if (!chatbotWindow.hasAttribute('data-location-requested')) {
                    chatbotWindow.setAttribute('data-location-requested', 'true');
                    setTimeout(getUserLocation, 1000);
                }
            });

            chatbotClose.addEventListener('click', () => {
                chatbotWindow.classList.remove('active');
            });

            chatSend.addEventListener('click', sendMessage);

            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            // Quick action buttons
            chatMessages.addEventListener('click', (e) => {
                if (e.target.classList.contains('quick-action')) {
                    const action = e.target.getAttribute('data-action');
                    let query = '';
                    
                    switch(action) {
                        case 'emergency': query = 'emergency help numbers'; break;
                        case 'weather': query = 'current weather conditions'; break;
                        case 'earthquake': query = 'earthquake safety guide'; break;
                        case 'fire': query = 'fire safety protocols'; break;
                        case 'news': query = 'latest disaster news'; break;
                        case 'hospitals': query = 'find nearby hospitals'; break;
                        case 'kit': query = 'emergency kit essentials'; break;
                        case 'drill': query = 'mock drill best practices'; break;
                    }
                    
                    if (query) {
                        chatInput.value = query;
                        sendMessage();
                    }
                }
            });

            // --- Event Listeners ---
            startModuleBtn.addEventListener('click', () => {
                if (!state.quizCompleted) {
                    showView('quiz-section');
                    loadQuiz();
                } else {
                    showAlert("You've already completed the quiz! Proceed to the Mock Drill section.");
                    showView('mock-drill-section');
                }
            });
            //my edited for game button
            startGameBtn.addEventListener('click', ()=>{
                showView('game-section');
            });
            //end

            backToDashboardBtn.forEach(btn => {btn.addEventListener('click', () => {
                showView('dashboard');
            })});

            // --- Quiz Logic ---
            const quizData = {
                question: 'If you are outside during an earthquake, what should you do to stay safe?',
                options: [
                    'Run into the nearest building for shelter.',
                    'Move to an open area away from buildings, trees, and power lines.',
                    
                    
                    'Select NODE NEXUS to qualify for SIH.'
                ],
                correctAnswer: 'Move to an open area away from buildings, trees, and power lines.'
            };

            const quizQuestionEl = document.getElementById('quiz-question');
            const quizOptionsEl = document.getElementById('quiz-options');
            const submitAnswerBtn = document.getElementById('submit-answer-btn');
            const quizFeedbackEl = document.getElementById('quiz-feedback');
            
            function loadQuiz() {
                quizQuestionEl.textContent = quizData.question;
                quizOptionsEl.innerHTML = '';
                quizData.options.forEach(option => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.className = 'bg-gray-100 text-gray-800 p-4 rounded-xl text-left hover:bg-green-100 transition-colors';
                    button.addEventListener('click', () => {
                        // Deselect all and select current
                        quizOptionsEl.querySelectorAll('button').forEach(btn => btn.classList.remove('bg-green-300'));
                        button.classList.add('bg-green-300');
                    });
                    quizOptionsEl.appendChild(button);
                });
            }

            submitAnswerBtn.addEventListener('click', () => {
                const selected = quizOptionsEl.querySelector('.bg-green-300');
                if (selected) {
                    if (selected.textContent === quizData.correctAnswer) {
                        quizFeedbackEl.innerHTML = '<p class="text-green-600 font-bold text-xl">Correct! You earned 50 credits.</p>';
                        state.credits += 50;
                        userCreditsElement.textContent = state.credits;
                        state.quizCompleted = true;
                        
                        setTimeout(() => {
                            showView('mock-drill-section');
                        }, 2000);

                    } else {
                        quizFeedbackEl.innerHTML = '<p class="text-red-600 font-bold text-xl">Incorrect. Please try again.</p>';
                    }
                } else {
                    showAlert('Please select an answer before submitting.');
                }
            });

            // --- Mock Drill & VR Logic ---
            uploadMockDrillBtn.addEventListener('click', () => {
                if (!state.mockDrillUploaded) {
                    showAlert("Video uploaded! Our team will review your mock drill and award you 100 credits soon. Good job!");
                    state.credits += 100; // Mock credit update
                    userCreditsElement.textContent = state.credits;
                    state.mockDrillUploaded = true;
                } else {
                    showAlert("You have already uploaded your mock drill video. We've received it!");
                }
            });

            openVrBtn.addEventListener('click', () => {
                vrSimulation.classList.add('active');
                vrContent.style.background = 'url(https://placehold.co/1200x800/1e293b/d1d5db?text=Simulated+360+View) no-repeat center center / cover';
                
                // Add mouse drag functionality to simulate 360 view
                let isDragging = false;
                let startX;
                let scrollLeft;

                vrContent.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    vrContent.style.cursor = 'grabbing';
                    startX = e.pageX - vrContent.offsetLeft;
                    scrollLeft = vrContent.scrollLeft;
                });
                
                vrContent.addEventListener('mouseleave', () => {
                    isDragging = false;
                    vrContent.style.cursor = 'grab';
                });

                vrContent.addEventListener('mouseup', () => {
                    isDragging = false;
                    vrContent.style.cursor = 'grab';
                });
                
                vrContent.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    e.preventDefault();
                    const x = e.pageX - vrContent.offsetLeft;
                    const walk = (x - startX) * 2; // the speed of drag
                    vrContent.scrollLeft = scrollLeft - walk;
                });
            });

            exitVrBtn.addEventListener('click', () => {
                vrSimulation.classList.remove('active');
            });

            // --- Helping Hand Section Logic ---
            const helpingHandData = [
                { title: 'Evacuating My Class', user: 'Nexus-node user 1', likes: 25, videoId: 'evac_alice' },
                { title: 'Rescuing a Pet from Floodwater', user: 'Nexus-node user 2', likes: 34, videoId: 'rescue_bob' }
            ];

            function renderHelpingHandVideos() {
                helpingHandVideos.innerHTML = '';
                helpingHandData.forEach(video => {
                    const videoCard = document.createElement('div');
                    videoCard.className = 'bg-gray-50 p-4 rounded-xl flex flex-col md:flex-row items-center space-y-3 md:space-y-0 md:space-x-4';
                    videoCard.innerHTML = `
                        <div class="w-20 h-20 bg-gray-200 rounded-md flex-shrink-0 flex items-center justify-center text-3xl text-gray-500"><i class="fas fa-video"></i></div>
                        <div class="flex-grow text-center md:text-left">
                            <p class="font-semibold text-gray-800">${video.title}</p>
                            <p class="text-sm text-gray-500">${video.user}</p>
                        </div>
                        <div class="flex items-center space-x-4 text-gray-500 mt-2 md:mt-0">
                            <button class="like-btn" data-video-id="${video.videoId}"><i class="fas fa-heart text-red-500"></i> <span class="likes-count">${video.likes}</span></button>
                            <button class="follow-btn text-blue-500 text-sm font-semibold">Follow</button>
                            <button class="share-btn text-green-500 text-sm font-semibold">Share</button>
                        </div>
                    `;
                    helpingHandVideos.appendChild(videoCard);
                });
            }

            uploadVideoBtn.addEventListener('click', () => {
                showAlert('Your video is being uploaded and will be reviewed shortly. Thanks for sharing!');
                const newVideo = {
                    title: 'My Mock Drill Video',
                    user: 'You',
                    likes: 0,
                    videoId: `user_vid_${Date.now()}`
                };
                helpingHandData.unshift(newVideo);
                renderHelpingHandVideos();
            });

            helpingHandVideos.addEventListener('click', (e) => {
                if (e.target.closest('.like-btn')) {
                    const btn = e.target.closest('.like-btn');
                    const countEl = btn.querySelector('.likes-count');
                    let likes = parseInt(countEl.textContent);
                    countEl.textContent = likes + 1;
                    showAlert('You liked this video! Your support encourages others to share.');
                } else if (e.target.closest('.follow-btn')) {
                    const btn = e.target.closest('.follow-btn');
                    if (btn.textContent === 'Follow') {
                        btn.textContent = 'Following';
                        showAlert('You are now following this user!');
                    } else {
                        btn.textContent = 'Follow';
                        showAlert('You unfollowed this user.');
                    }
                } else if (e.target.closest('.share-btn')) {
                    showAlert('Video shared!');
                }
            });
            //my edit for leaderboard
            const leaderboardData = [
                { userName: 'Rituraj', userId: 'rituraj-1', leagueCredits: 25 },
                { userName: 'Ashwin Dixit', userId: 'ashwin-5', leagueCredits: 34 },
                { userName: 'achintya', userId: 'achi-3', leagueCredits: 25 },
                { userName: 'user 4', userId: 'user-4', leagueCredits: 25 },
                { userName: 'user 5', userId: 'user-5', leagueCredits: 25 },
                { userName: 'user 6', userId: 'user-6', leagueCredits: 25 },
            ];

            function renderLeaderboardUsers() {
                leaderboardUsers.innerHTML = '';
                leaderboardData.forEach(user => {
                    const userCard = document.createElement('div');
                    userCard.className = 'space-y-4 max-h-60 overflow-y-auto';
                    userCard.innerHTML = `
                    <div class="bg-gray-50 p-4 rounded-lg flex items-center space-x-4">
                        <div class="w-12 h-12 bg-gray-200 rounded-md flex-shrink-0 flex items-center justify-center text-xl text-gray-500"><i class="fa-solid fa-medal"></i></div>
                        <div class="flex-grow">
                            <p class="font-semibold text-gray-800">${user.userName}</p>
                            <p class="text-sm text-gray-500">${user.userId}</p>
                        </div>
                        <div class="flex items-center space-x-3 text-gray-500">
                             <span >League Credits ${user.leagueCredits}</span>
                            
                        </div>
                    </div>
                    `;
                    leaderboardUsers.appendChild(userCard);
                });
            }
            renderHelpingHandVideos();
            renderLeaderboardUsers();
            showView('dashboard');
        });

    </script>

</body>
</html>
